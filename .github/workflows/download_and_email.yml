name: '手动发送邮件消息'

# 配置手动触发，并定义新的三个输入框
on:
  workflow_dispatch:
    inputs:
      email_subject:
        description: '📝 邮件主题 (对话形式)'
        required: true
        default: '来自 GitHub Actions 的通知'
      email_body:
        description: '💬 邮件内容 (输入内容)'
        required: true
        default: '这是一条通过 GitHub Actions 发送的测试消息。'
      recipient_email:
        description: '📧 收件人邮箱地址 (收件人)'
        required: true
        default: '275559292@qq.com' 

jobs:
  send_message:
    name: '发送邮件任务'
    runs-on: ubuntu-latest

    steps:
      # 步骤 1: 打印输入信息 (可选，用于调试)
      - name: 1. 检查并确认输入信息
        run: |
          echo "目标邮箱: ${{ github.event.inputs.recipient_email }}"
          echo "邮件主题: ${{ github.event.inputs.email_subject }}"
          echo "邮件正文（前50字符）: ${{ github.event.inputs.email_body }}"

      # 步骤 2: 发送邮件
      - name: 2. 发送消息邮件
        uses: dawidd6/action-send-mail@v3
        with:
          # SMTP 服务器配置 (必须使用 Secrets)
          server_address: ${{ secrets.SMTP_HOST }}
          server_port: ${{ secrets.SMTP_PORT }}
          username: ${{ secrets.SMTP_USERNAME }}
          password: ${{ secrets.SMTP_PASSWORD }} 

          # 邮件内容配置
          # 使用用户输入的“对话形式”作为主题
          subject: ${{ github.event.inputs.email_subject }}
          
          # 使用用户输入的“收件人”邮箱
          to: ${{ github.event.inputs.recipient_email }}
          
          # 发件人
          from: GitHub Actions <${{ secrets.SMTP_USERNAME }}> 
          
          # 使用用户输入的“输入内容”作为正文
          body: ${{ github.event.inputs.email_body }}
          
          # 格式化正文为 HTML 或纯文本
          content_type: text/plain
