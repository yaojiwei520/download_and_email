name: '手动发送邮件 (带附件)'

on:
  workflow_dispatch:
    inputs:
      email_subject:
        description: '📝 邮件主题'
        required: true
        default: '附件邮件通知'
      email_body:
        description: '💬 邮件内容'
        required: true
        default: '请查收附件。'
      recipient_email:
        description: '📧 收件人邮箱地址'
        required: true
        default: '275559292@qq.com' 
      attachment_path: # 新增附件路径输入
        description: '📎 附件文件路径 (Runner工作区内的文件)'
        required: false # 附件不是必须的
        default: './README.md' # 默认使用仓库中必有的文件作为示例

jobs:
  send_message:
    name: '发送邮件任务'
    runs-on: ubuntu-latest

    # 步骤 0: 检出代码，确保能访问到附件文件
    - name: 0. 检出仓库代码
      uses: actions/checkout@v4

    # 步骤 1: 发送邮件 (带附件)
    - name: 1. 发送邮件
      uses: dawidd6/action-send-mail@v3
      with:
        # SMTP 服务器配置
        server_address: ${{ secrets.SMTP_HOST }}
        server_port: ${{ secrets.SMTP_PORT }}
        username: ${{ secrets.SMTP_USERNAME }}
        password: ${{ secrets.SMTP_PASSWORD }} 

        # 邮件内容配置
        subject: ${{ github.event.inputs.email_subject }}
        to: ${{ github.event.inputs.recipient_email }}
        from: GitHub Actions <${{ secrets.SMTP_USERNAME }}> 
        body: ${{ github.event.inputs.email_body }}
        
        # 添加附件功能
        attachments: ${{ github.event.inputs.attachment_path }}
