name: 'æ‰‹åŠ¨ä¸‹è½½å¹¶å‘é€é‚®ä»¶ (å¯è‡ªå®šä¹‰é‚®ç®±)'

# 1. é…ç½®æ‰‹åŠ¨è§¦å‘
on:
  workflow_dispatch:
    # 2. å®šä¹‰è¾“å…¥æ¡†
    inputs:
      download_url:
        description: 'â¬‡ï¸ æ–‡ä»¶ä¸‹è½½ URL'
        required: true
        default: 'https://example.com/default_file.zip'
      file_name:
        description: 'ğŸ“„ ä¿å­˜çš„æ–‡ä»¶å (å¿…é¡»åŒ…å«åç¼€)'
        required: true
        default: 'downloaded_file.zip'
      
      # --- æ–°å¢çš„è¾“å…¥æ¡† ---
      recipient_email:
        description: 'ğŸ“§ æ¥æ”¶æ–‡ä»¶çš„é‚®ç®±åœ°å€'
        required: true
        default: '275559292@qq.com' # å°†æ‚¨å¸¸ç”¨çš„é‚®ç®±ä½œä¸ºé»˜è®¤å€¼

jobs:
  download_and_send_email:
    name: 'ä¸‹è½½å¹¶å‘é€ä»»åŠ¡'
    runs-on: ubuntu-latest

    steps:
      # æ­¥éª¤ 1: ä¸‹è½½æ–‡ä»¶
      - name: 1. ä¸‹è½½æ–‡ä»¶
        run: |
          echo "å‡†å¤‡ä» ${{ github.event.inputs.download_url }} ä¸‹è½½..."
          curl -L -o "${{ github.event.inputs.file_name }}" "${{ github.event.inputs.download_url }}"
          
          echo "æ–‡ä»¶ä¸‹è½½å®Œæˆ!"
          echo "æ–‡ä»¶å: ${{ github.event.inputs.file_name }}"
          echo "æ–‡ä»¶å¤§å°: $(ls -lh ${{ github.event.inputs.file_name }} | awk '{print $5}')"

      # æ­¥éª¤ 2: å‘é€é‚®ä»¶ï¼ˆå¸¦é™„ä»¶ï¼‰
      - name: 2. å‘é€é‚®ä»¶
        uses: dawidd6/action-send-mail@v3
        with:
          # SMTP æœåŠ¡å™¨é…ç½® (ä¿æŒä¸å˜, å¿…é¡»ä½¿ç”¨ Secrets)
          server_address: ${{ secrets.SMTP_HOST }}
          server_port: ${{ secrets.SMTP_PORT }}
          username: ${{ secrets.SMTP_USERNAME }}
          password: ${{ secrets.SMTP_PASSWORD }} 

          # é‚®ä»¶å†…å®¹é…ç½®
          subject: 'âœ… GitHub Actions ä¸‹è½½ä»»åŠ¡å®Œæˆ: ${{ github.event.inputs.file_name }}'
          
          # --- å…³é”®æ›´æ”¹ ---
          # 'to' å­—æ®µç°åœ¨ä½¿ç”¨è¾“å…¥å˜é‡
          to: ${{ github.event.inputs.recipient_email }}
          
          from: GitHub Actions <${{ secrets.SMTP_USERNAME }}> # å»ºè®® 'from' åœ°å€ä¸ 'username' ä¸€è‡´
          
          # é‚®ä»¶æ­£æ–‡
          body: |
            æ‚¨åœ¨ GitHub Actions è§¦å‘çš„ä¸‹è½½ä»»åŠ¡å·²å®Œæˆã€‚
            
            ç›®æ ‡é‚®ç®±: ${{ github.event.inputs.recipient_email }}
            æ–‡ä»¶å:   ${{ github.event.inputs.file_name }}
            ä¸‹è½½æº:   ${{ github.event.inputs.download_url }}
            
            è¯·æŸ¥æ”¶é™„ä»¶ã€‚
          
          # é™„ä»¶
          attachments: ./${{ github.event.inputs.file_name }}
          
      # æ­¥éª¤ 3: æ¸…ç†ä¸‹è½½çš„æ–‡ä»¶
      - name: 3. æ¸…ç†å·¥ä½œåŒºæ–‡ä»¶
        if: always() # æ— è®ºä¸Šä¸€æ­¥æ˜¯å¦æˆåŠŸï¼Œéƒ½æ‰§è¡Œæ¸…ç†
        run: |
          echo "æ¸…ç†ä¸‹è½½çš„æ–‡ä»¶..."
          rm -f "${{ github.event.inputs.file_name }}"
          echo "æ¸…ç†å®Œæˆã€‚"